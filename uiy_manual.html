<!DOCTYPE html>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>

<link rel="stylesheet" href="styleguide.css" />
<link rel="stylesheet" href="style_uiy_manual.css" />

<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Dela+Gothic+One&display=swap" rel="stylesheet" />
</head>

<body>
  <main class="ipad-pro-uiy">
    <div class="top">
      <header class="header">
        <a href="index.html" aria-label="ClubEarth 홈으로 이동">
          <img class="logo" src="https://c.animaapp.com/acujdZT9/img/logo-1.svg" alt="ClubEarth" />
        </a>
        <a href="mypage.html">
          <p class="p">
            <span class="span">반가워요, </span>
            <span class="text-wrapper-4">부원</span>
            <span class="span">님</span>
          </p>
        </a>

        <nav class="buttons" aria-label="주요 메뉴">
          <a href="mypage.html"><button class="button-mypage" aria-label="마이페이지">
              <span class="img-wrapper"><img class="union" src="https://c.animaapp.com/acujdZT9/img/union-3.svg"
                  alt="" /></span></button></a>
          <a href="community.html"><button class="button-community" aria-label="커뮤니티">
              <img class="img-wrapper" src="https://c.animaapp.com/acujdZT9/img/icon-communityoff-2.svg"
                alt="" /></button></a>
          <a href="uiy_select.html"><button class="button-uiy" aria-label="제작하기" aria-current="page">
              <span class="img-wrapper">
                <img class="exclude" src="img/icon_uiy.png" alt="" />
              </span></button></a>
        </nav>
      </header>
    </div>
  </main>
  <!-- ---top end--- -->
  <h1>
    Up It! Yourself<br><span>업사이클링을 시작해 볼까요?</span>
  </h1>
  <nav class="steps" aria-label="진행 단계">
    <img src="img/steps_04.png" alt="4단계 중 4단계" />
  </nav>

  <div class="item_after">


    <div class="items">
      <div class="item"><img src="img/item_01.jpg" class="item_before">
        <div class="item_after">
          <div class="shots"><iframe
            src="https://www.youtube.com/embed/RgnXuDqDA1I?autoplay=1&mute=1&modestbranding=1&controls=0&loop=1&start=0&end=11&playlist=RgnXuDqDA1I"
            height="534" width="300.5" frameborder="0" allow="autoplay">
          </iframe></div>
          
          <img src="img/item_detail_01.jpg">
        </div>
      </div>
      
      <div class="item"><img src="img/item_02.jpg" class="item_before">
        <div class="item_after">
          <div class="shots"><iframe
            src="https://www.youtube.com/embed/RgnXuDqDA1I?autoplay=1&mute=1&modestbranding=1&controls=0&loop=1&start=12&end=18&playlist=RgnXuDqDA1I"
            height="534" width="300" frameborder="0" allow="autoplay">
          </iframe></div>
          
          <img src="img/item_detail_02.jpg">
        </div>
      </div>
      
      <div class="item"><img src="img/item_03.jpg" class="item_before">
        <div class="item_after">
          <div class="shots"><iframe
            src="https://www.youtube.com/embed/RgnXuDqDA1I?autoplay=1&mute=1&modestbranding=1&controls=0&loop=1&start=19&end=21&playlist=RgnXuDqDA1I"
            height="534" width="300.5" frameborder="0" allow="autoplay">
          </iframe></div>
          
          <img src="img/item_detail_03.jpg">
        </div>
      </div>

      <div class="item"><img src="img/item_04.jpg" class="item_before">
        <div class="item_after">
          <div class="shots"><iframe
            src="https://www.youtube.com/embed/RgnXuDqDA1I?autoplay=1&mute=1&modestbranding=1&controls=0&loop=1&start=20&end=54&playlist=RgnXuDqDA1I"
            height="534" width="300.5" frameborder="0" allow="autoplay">
          </iframe></div>
          
          <img src="img/item_detail_04.jpg">
        </div>
      </div>

      <div class="item"><img src="img/item_05.jpg" class="item_before">
        <div class="item_after">
          <div class="shots"><iframe
            src="https://www.youtube.com/embed/RgnXuDqDA1I?autoplay=1&mute=1&modestbranding=1&controls=0&loop=1&start=54&end=63&playlist=RgnXuDqDA1I"
            height="534" width="300.5" frameborder="0" allow="autoplay">
          </iframe></div>
          
          <img src="img/item_detail_05.jpg">
        </div>
      </div>

      <div class="item"><img src="img/item_06.jpg" class="item_before">
        <div class="item_after">
          <div class="shots"><iframe
            src="https://www.youtube.com/embed/RgnXuDqDA1I?autoplay=1&mute=1&modestbranding=1&controls=0&loop=1&start=63&end=71&playlist=RgnXuDqDA1I"
            height="534" width="300.5" frameborder="0" allow="autoplay">
          </iframe></div>
          
          <img src="img/item_detail_06.jpg">
        </div>
      </div>
    </div>

    <div class="bottom_buttons">
      <a href="uiy_guide.html">
        <button class="back">
          <img src="img/icon_more.png" />
          <p>BACK</p>
        </button></a>
      <div class="item_icon">
        <img src="img/item_icon.png">
        <img src="img/item_icon-1.png">
        <img src="img/item_icon-1.png">
        <img src="img/item_icon-2.png">
        <img src="img/item_icon-1.png">
        <img src="img/item_icon-3.png">
        <a href="uiy_complete.html">
          <button class="button-done">
            <p>완성!</p>
            <img src="https://c.animaapp.com/acujdZT9/img/frame-357.svg" alt="" />
          </button></a>
        <div class="line"></div>
      </div>
    </div>

    <button class="modal-nav-btn prev" id="modal-prev-btn">
    <img src="img/icon_more.png" alt="이전">
  </button>
  <button class="modal-nav-btn next" id="modal-next-btn">
    <img src="img/icon_more.png" alt="다음">
  </button>

  <div class="bg">
    <video class="bg_video" autoplay muted loop>
      <source src="img/Comp02.mp4" type="video/mp4" />
    </video>
  </div>
</body>

<script>
  // 페이지 로드가 완료되면 스크립트 실행
  document.addEventListener('DOMContentLoaded', () => {

    const allItems = document.querySelectorAll('.item');
    
    // 1. (수정) 새롭게 추가된 요소들을 변수에 저장
    const body = document.body;
    const nextButton = document.getElementById('modal-next-btn');
    const prevButton = document.getElementById('modal-prev-btn');

    // 2. (수정) 상세 콘텐츠가 있는 아이템 목록과 현재 인덱스
    const clickableItems = Array.from(allItems).filter(item => item.querySelector('.item_after'));
    let currentActiveIndex = -1; // 현재 열린 아이템의 인덱스 (-1은 닫힘)

    // 3. 클릭 가능한 아이템들에 이벤트 리스너 추가
    clickableItems.forEach((clickedItem, currentIndex) => {

      clickedItem.addEventListener('click', () => {
        const wasActive = clickedItem.classList.contains('is-active');

        // (중요) 모든 아이템을 닫고, 모든 iframe 비디오를 중지
        allItems.forEach(itemToClose => {
          itemToClose.classList.remove('is-active');
          const iframe = itemToClose.querySelector('iframe');
          if (iframe) {
            iframe.src = iframe.src; 
          }
        });

        // (수정) body의 클래스도 초기화
        body.classList.remove('modal-is-active', 'showing-first-item');
        currentActiveIndex = -1; // 인덱스 초기화

        // 만약 닫혀있던 아이템이었다면, 다시 엽니다.
        if (!wasActive) {
          clickedItem.classList.add('is-active');
          
          // (수정) body에 상태 클래스 추가
          body.classList.add('modal-is-active');
          currentActiveIndex = currentIndex; // 현재 인덱스 저장

          // (수정) 첫 번째 아이템인지 확인
          if (currentIndex === 0) {
            body.classList.add('showing-first-item');
          }
        }
      });
    });

    // --- 4. (추가) '다음' 버튼 클릭 이벤트 ---
    nextButton.addEventListener('click', () => {
      if (currentActiveIndex === -1) return; // 활성화된게 없으면 무시

      // 다음 인덱스 계산 (마지막이면 0으로 순환)
      const nextIndex = (currentActiveIndex + 1) % clickableItems.length;
      
      // 다음 아이템에 대해 '클릭' 이벤트를 강제로 발생시킴
      // (기존 3번 로직이 재사용되어, 현재 창은 닫히고 다음 창이 열림)
      clickableItems[nextIndex].click();
    });

    // --- 5. (추가) '이전' 버튼 클릭 이벤트 ---
    prevButton.addEventListener('click', () => {
      // 0 이하거나 활성화된게 없으면 무시
      if (currentActiveIndex <= 0) return; 

      const prevIndex = currentActiveIndex - 1;
      
      // 이전 아이템에 대해 '클릭' 이벤트를 강제로 발생시킴
      clickableItems[prevIndex].click();
    });

  });
</script>